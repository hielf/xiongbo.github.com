<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>xiongbo.ME</title>
  <meta name="author" content="xiongbo">
  
  
  <meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1">

  
  <meta property="og:site_name" content="xiongbo.ME"/>

  <link rel="alternate" href="/atom.xml" title="xiongbo.ME" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">xiongbo.ME</a></h1>
  <h2><a href="/">project code and simple life</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">

  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2013-01-08T06:33:06.000Z"><a href="/2013/01/08/2013-01-08-start-blog-with-hexo/">Jan 8, 2013</a></time>
      
      
  
    <h1 class="title"><a href="/2013/01/08/2013-01-08-start-blog-with-hexo/">start blog with hexo</a></h1>
  

    </header>
    <div class="entry">
      
        <p>新的一年，博客也要寻求新的面貌。没想到开年就让我看到了它：(Hexo)[<a href="http://zespia.tw/hexo/">http://zespia.tw/hexo/</a>]

</p>
<p>Hexo是基于NodeJS的静态blog生成框架。它有以下的特性：

</p>
<blockquote>
<p>不可思議的快速 ─ 只要一眨眼靜態檔案即生成完成
支援 markdown
僅需一道指令即可佈署到 github pages 和 heroku
已移植 octopress 外掛
高擴展性、自訂性
相容於 windows, mac &amp; linux

</p>
</blockquote>
<p>从wordpress到jekyll，再到octopress，最后是hexo。2013年，如果不出意外，应该暂时不会折腾了。

</p>
<p>以下是安装的时候需要注意的一些问题：

</p>
<ul>
<li>linux下按照网站上的教程进行部署就可以了；</li>
<li>windows下，需要通过(msgit)[<a href="http://code.google.com/p/msysgit/]安装好git">http://code.google.com/p/msysgit/]安装好git</a></li>
<li>不要通过普通的控制台进行操作，而是通过git bash安装、配置、生成、部署hexo</li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-12-31T14:42:00.000Z"><a href="/2012/12/31/2012-12-31-monthly-summary-09-12/">Dec 31, 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/12/31/2012-12-31-monthly-summary-09-12/">月度总结--09-12</a></h1>
  

    </header>
    <div class="entry">
      
        <p>2012年的最后一天，我才坐在电脑前开始记录这最后四个月的学习总结。

</p>
<p>不是我懒，而是有一位小天使一直在吸引着我的注意力，让我的视线与思考总是围绕着她，而无法自拔！

</p>
<p>关于小天使的故事，那将是一个long，long，story了。

</p>
<p>如果我这次的判断没有问题，我希望在未来的时间里，将我所经历的一些问题，记录在这里，以给那些和我同样困惑、纠结、心疼的父母们一些参考。

</p>
<hr>
<p>好了，言归正传。

</p>
<p>在这最后的四个月里，我和我的同事们在团队协作方面进行了一些尝试，并将它们使用在了我们的一个新项目中，目前项目已经快要收尾，我们也得到了很多的收获。

</p>
<p>我将按照我们项目的进程和引入的先后顺序进行记录：

</p>
<h1>Axure</h1>
<p>这款软件我个人很早的时候就在系统的原型设计中使用过，当时非常感叹它在设计交互操作方面的便利和强大。但是出于对中文的支持性和性能上的问题，没有持续的使用下去。

</p>
<p>而现在最新的版本，对中文进行了完美的支持，而且增加了一个非常实用的功能：<em>Share</em>。

</p>
<p>通过这个功能，我们就可以在团队中进行协作设计，下面是我们的使用体验：

</p>
<ul>
<li><p>由专人进行界面框架模板或组件的制作，所有人都可以即时获取，并应用在自己的模块中。</p>
</li>
<li><p>对我们这种小型的团队，每个人既做功能设计，也做代码开发，那么由擅长设计的同事进行统一的交互模板的制作就能保证系统的一致性，提高设计效率。</p>
</li>
<li><p>遇到设计上的问题，大家随时进行讨论，确定方案后，归档到模板库</p>
</li>
<li><p>界面设计人员也能方便的将低保真模型转化为高保真模型。并对各类界面组件进行设计，归档到模板库中。</p>
</li>
</ul>
<h1>GitCafe</h1>
<p>这个就不用说了，是GitHub的中文版，为什么不用GitHub，主要是考虑到中文可能更容易被团队成员所接收，推广起来也更加容易。

</p>
<p>而且事实证明也确实是这样，在大家通过GitCafe熟悉了基本的操作和git的理念后，如有需要，再迁移到GitHub上也是很方便的事情。

</p>
<p>本来在使用近3个月的GitCafe后，我们应该是不会考虑迁移到GitHub的，但是，GitCafe的不稳定和一些Bug还是让我们离开了，可见产品的稳定对产品运营有多重要。用户的忠诚度其实是很低的，特别是在当前每一类产品都存在多种选择的情况下，首先要在保证核心功能稳定的前提下，再逐步扩展其他的功能特性。在这点上，我觉得GitCafe走的过急了一点。


</p>
<h1>tower.im</h1>
<p>这是由彩程设计驱动的一款项目管理工具。

</p>
<p>其主要功能是创建、分配、跟踪、讨论、管理项目的任务清单。

</p>
<p>我们在使用中一般是分为以下几类的任务：

</p>
<ul>
<li><p>功能列表：每个人会将自己所负责的模块进行分解，提炼出所有的功能特性，并转化为任务清单。项目经理或者开发经理对这些任务清单按照项目要求进行优先级排序，然后再由各个开发人员设定完成时间，在开发的过程中，项目经理或者开发经理能够根据完成的情况，随时对功能或代码进行检查，并根据审查的情况进行调整。</p>
</li>
<li><p>TO-DO列表：这类任务主要是开发人员或者项目经理在开发过程中或项目进展中发现的新的问题及新的需求。在每天的项目例会中进行讨论，并根据需要加到功能模块分类中或延迟列表分类中。</p>
</li>
<li><p>延迟列表分类：这里主要是一些无法在当前的项目阶段进行实现的特性列表。</p>
</li>
<li><p>Bug列表：项目参与人员在测试、使用、开发过程中所发现的各类缺陷，都会即时的登记在该列表中，并指派给对应的负责人，由该人员进行修复。</p>
</li>
</ul>
<h1>teamcola</h1>
<p>这是一款团队日志记录和管理工具，也是由彩程设计驱动的。

</p>
<p>其主要功能是提供工作日志的记录、统计、导出等功能。

</p>
<p>它吸引我们的主要原因就是良好的用户体验和强大的统计，谁用谁知道。

</p>
<p>话说基于rails开发的项目，都有很棒的用户体验，tower.im也是这样。

</p>
<p>做产品就是做细节，这句话真的一点也不假。

</p>
<hr>
<p>以上就是我们围绕项目开发和团队建设所进行的一些尝试，虽然不多，但是用好了，确实可以给团队带来效率的提升和管理的便捷。

</p>
<p>另外就是，我们在项目中首次采用了codefirst的方式，基于MVC3进行开发，中间也遇到了一些坑，待我总结后，也会发上来进行共享。</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-10-08T14:42:00.000Z"><a href="/2012/10/08/2012-09-03-monthly-summary-07-08/">Oct 8, 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/10/08/2012-09-03-monthly-summary-07-08/">月度总结--07-08</a></h1>
  

    </header>
    <div class="entry">
      
        <ul>
<li>基于mongoid，编写了自定义表单的demo</li>
<li>看了一本mysql入门书，发现指令和sqlserver基本一样，期待日后的深入了解</li>
<li>看完了《ruby入门》和《ruby元编程》,更加坚定了深入学习ruby的决心</li>
<li>鸟哥的linux入门看了一半，忘了一大半</li>
<li>粗略的读了一遍《基于mvc的javascript富客户端开发》和《node.js开发指南》，感觉目前还派不上用场，公司的项目目前也难以用到</li>
<li>吴军的《数学之美》看了一半，越发的崇拜了。。。</li>
<li>阅读了《编写可读代码的艺术》，发现很多内容都是ruby社区内的共识，并没有大家所说的醍醐灌顶的感觉</li>
<li>完整的编写了一个简单的rails应用，包括测试,国际化,部署。下一步是逐步的进行完善，并在公司内推广rails</li>
<li>渐渐养成了看技术类文档勤做笔记的习惯，并通过git进行管理</li>
<li>又开始被单词了，使用的是扇贝网的应用，目前坚持了30天，亲身体验，非常有效果，比拓词效果好，细水长流，坚持是王道</li>
<li>听力似乎有进步，看了半部的美国派4，没有字幕支持，也可以笑的不亦乐乎，按照目前的方式，三个月后再测试效果</li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-07-27T00:00:00.000Z"><a href="/2012/07/27/2012-07-27-use-excel-to-create-protype/">Jul 27, 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/07/27/2012-07-27-use-excel-to-create-protype/">基于excel制作系统原型</a></h1>
  

    </header>
    <div class="entry">
      
        <h4>为什么要用excel制作呢？</h4>
<p>因为excel很强大，废话。。
因为excel很通用，实话。。
因为excel易用，这。。一半一半吧。。

</p>
<h4>如何制作</h4>
<p>其实制作起来很容易，原理就和网页的设计的栅格是一个道理。比如我们可以把界面想像成100＊100的方格组成。界面上的所有元素都是由这些方格组成，包括元素间的间距。这样，我们绘制元素，对齐，分割，合并就非常容易，而且都是有比例可寻的。

</p>
<p>了解了这些，就可以动手了。当然，首先，你要有excel，windows的哦，linux的没试过。

</p>
<p>然后，很重要的一步就是设置excel网格的高度和宽度，我常用的比例是行高9，行宽1，这样的话，每个网格近似正方形。

</p>
<p>接下来，一般是取消网格线，在字体中设置好网格线的颜色，就可以开始制作原型了。

</p>
<p>由于excel本身就是设计用于展示数据的，所以一般在设计应用型的界面的时候，就非常方便。特别是需要展示大量的数据，比如报表的时候，很容易就能得到客户的认同。同时，由于excel的数据统计功能，可以绘制出非常棒的图表，这也是其他原型设计软件，比如axure,mockups,visio所无法实现的。

</p>
<p>但是相比其他的工具，excel也有一些问题，比如无法实现动态的效果(虽然也可以生成网页，但是鉴于在各个浏览器中的兼容性并不好，不推荐使用)，无法制作高保真的页面效果等等。这其中的利弊，就需要根据项目的类型进行抉择了。

</p>
<p>下面是一些设计的例子，可供参考：
<img src="/public/pics/excel/table.png" alt="表格">
<img src="/public/pics/excel/table2.png" alt="表格">
<img src="/public/pics/excel/statics.png" alt="统计">
<img src="/public/pics/excel/query.png" alt="查询">
<img src="/public/pics/excel/composite.png" alt="综合"></p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-07-05T00:00:00.000Z"><a href="/2012/07/05/2012-07-05-mongodb-custom-form/">Jul 5, 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/07/05/2012-07-05-mongodb-custom-form/">基于mongodb的自定义表单实现思考</a></h1>
  

    </header>
    <div class="entry">
      
        <h4>如何通过mongoid构建表单的数据结构</h4>
<p>通过mongoid提供的继承行为，可以有效的表现表单的字段，我的想法如下，这样各类字段不仅能作为XboForm的嵌入文档，同时也可以满足不同字段的个性化信息，如果不使用继承，就只能在模型中包括所有可能的字段属性

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div><div class="line-number">5</div><div class="line-number">6</div><div class="line-number">7</div><div class="line-number">8</div><div class="line-number">9</div><div class="line-number">10</div><div class="line-number">11</div><div class="line-number">12</div><div class="line-number">13</div><div class="line-number">14</div><div class="line-number">15</div><div class="line-number">16</div><div class="line-number">17</div><div class="line-number">18</div><div class="line-number">19</div><div class="line-number">20</div><div class="line-number">21</div><div class="line-number">22</div><div class="line-number">23</div><div class="line-number">24</div><div class="line-number">25</div><div class="line-number">26</div></code></pre></td><td class="code"><pre><code><div class="line"> </div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">XboField</span></span></div><div class="line">  <span class="keyword">include</span> <span class="constant">Mongoid::Document</span></div><div class="line">  <span class="keyword">include</span> <span class="constant">Mongoid::Timestamps</span> </div><div class="line">  field <span class="symbol">:name</span></div><div class="line">  field <span class="symbol">:label</span></div><div class="line">  field <span class="symbol">:help_text</span></div><div class="line">  field <span class="symbol">:required</span>, <span class="symbol">type:</span> <span class="constant">Boolean</span></div><div class="line">  field <span class="symbol">:type</span></div><div class="line">  validates_presence_of <span class="symbol">:name</span> </div><div class="line">  embedded_in <span class="symbol">:xbo_form</span> </div><div class="line"><span class="keyword">end</span></div><br><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">XboString</span> <span class="inheritance">&lt; <span class="parent">XboField</span></span></span></div><div class="line">  field <span class="symbol">:max_length</span>, <span class="symbol">type:</span> <span class="constant">Integer</span></div><div class="line"><span class="keyword">end</span></div><br><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">XboEmail</span> <span class="inheritance">&lt; <span class="parent">XboField</span></span></span></div><div class="line"><span class="keyword">end</span></div><br><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">XboSelect</span> <span class="inheritance">&lt; <span class="parent">XboField</span></span></span></div><div class="line"><span class="keyword">end</span></div><br><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">XboTextarea</span> <span class="inheritance">&lt; <span class="parent">XboField</span></span></span></div><div class="line">  field <span class="symbol">:word_limit</span>, <span class="symbol">type:</span> <span class="constant">Integer</span></div><div class="line"><span class="keyword">end</span></div></code></pre></td></tr></table></figure>

<h4>编辑表单字段的时候，如何表示不同的表单字段呢？</h4>
<p>可以通过rails中的fields_for在同一个提交表单中表现不同的字段项，需要注意的是由于各个字段作为内嵌文档是以数组的形式保存的，不能采用形如rails guide中的a_from.b_fields.text_field形式，而是要先通过build方法生成实例，再进行使用，以email字段为例：

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div><div class="line-number">5</div><div class="line-number">6</div><div class="line-number">7</div><div class="line-number">8</div><div class="line-number">9</div><div class="line-number">10</div><div class="line-number">11</div><div class="line-number">12</div><div class="line-number">13</div></code></pre></td><td class="code"><pre><code><div class="line">    </div><div class="line">&lt;% xbo_email = <span class="variable">@xbo_form</span>.xbo_fields.build({},<span class="constant">XboEmail</span>) %&gt;</div><div class="line">&lt;%= form_for <span class="variable">@xbo_form</span>, <span class="symbol">url:</span> xbo_forms_path <span class="keyword">do</span> |f| %&gt;</div><div class="line">  &lt;%= f.label <span class="string">'名称'</span> %&gt;</div><div class="line">  &lt;%= f.text_field <span class="symbol">:name</span> %&gt;</div><br><div class="line">  &lt;%= fields_for xbo_email <span class="keyword">do</span> |xbo_email| %&gt;</div><div class="line">    &lt;%= xbo_email.label <span class="string">'字段名称：'</span> %&gt;</div><div class="line">    &lt;%= xbo_email.text_field <span class="symbol">:name</span> %&gt;</div><div class="line">    &lt;%= xbo_email.label <span class="string">'字段标签：'</span> %&gt;</div><div class="line">    &lt;%= xbo_email.text_field <span class="symbol">:label</span> %&gt;</div><div class="line">  &lt;% <span class="keyword">end</span> %&gt; </div><div class="line">&lt;% <span class="keyword">end</span> %&gt;</div></code></pre></td></tr></table></figure>

<p>这样，当提交表单的时候，就会产生形如以下的参数形式：

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div><div class="line-number">5</div><div class="line-number">6</div><div class="line-number">7</div><div class="line-number">8</div><div class="line-number">9</div></code></pre></td><td class="code"><pre><code><div class="line">{</div><div class="line">  id:xxxxxxx,</div><div class="line">  name:"zzzz",</div><div class="line">  XboEmail:{</div><div class="line">      _type: "XboEmail",</div><div class="line">      name: "xxxxx"</div><div class="line">      label: "yyyyyy"</div><div class="line">    }  </div><div class="line">}</div></code></pre></td></tr></table></figure>

<p>当对表单项进行保存的时候，可以通过_type属性，判断当前的字段类别，从而进行保存。

</p>
<p>但是这种设计其实是有问题的，不能因为字段在物理形式上是通过内嵌文档的方式保存在表单的集合中，就把对字段属性的修改也放在了表单的控制逻辑中。正确的方式应该是采用xbo_fields的控制器进行处理。可以采用如下的方式对field设置更明确的控制器。

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div></code></pre></td><td class="code"><pre><code><div class="line">resources <span class="symbol">:xbo_forms</span> <span class="keyword">do</span></div><div class="line">  resources <span class="symbol">:xbo_fields</span>, <span class="symbol">controller:</span> <span class="string">"xbo_form_xbo_fields"</span></div><div class="line"><span class="keyword">end</span></div></code></pre></td></tr></table></figure>

<hr>
<p><em>2012-7-12更新</em>

</p>
<h4>表单模板</h4>
<p>因为在进行表单设计的时候，表单项往往是动态生成的。并且，每个表单字段所包含的属性都不尽相同。所以应该针对不同的字段，设计不同的表单模板，以下拉菜单为例:

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div><div class="line-number">5</div><div class="line-number">6</div><div class="line-number">7</div><div class="line-number">8</div><div class="line-number">9</div><div class="line-number">10</div><div class="line-number">11</div><div class="line-number">12</div><div class="line-number">13</div><div class="line-number">14</div><div class="line-number">15</div><div class="line-number">16</div><div class="line-number">17</div><div class="line-number">18</div><div class="line-number">19</div><div class="line-number">20</div><div class="line-number">21</div><div class="line-number">22</div><div class="line-number">23</div><div class="line-number">24</div><div class="line-number">25</div><div class="line-number">26</div><div class="line-number">27</div><div class="line-number">28</div><div class="line-number">29</div><div class="line-number">30</div><div class="line-number">31</div><div class="line-number">32</div><div class="line-number">33</div><div class="line-number">34</div><div class="line-number">35</div><div class="line-number">36</div><div class="line-number">37</div><div class="line-number">38</div><div class="line-number">39</div><div class="line-number">40</div><div class="line-number">41</div><div class="line-number">42</div><div class="line-number">43</div><div class="line-number">44</div><div class="line-number">45</div><div class="line-number">46</div><div class="line-number">47</div><div class="line-number">48</div><div class="line-number">49</div><div class="line-number">50</div><div class="line-number">51</div><div class="line-number">52</div><div class="line-number">53</div><div class="line-number">54</div><div class="line-number">55</div><div class="line-number">56</div><div class="line-number">57</div><div class="line-number">58</div><div class="line-number">59</div><div class="line-number">60</div><div class="line-number">61</div><div class="line-number">62</div><div class="line-number">63</div><div class="line-number">64</div><div class="line-number">65</div><div class="line-number">66</div><div class="line-number">67</div><div class="line-number">68</div><div class="line-number">69</div><div class="line-number">70</div><div class="line-number">71</div><div class="line-number">72</div><div class="line-number">73</div><div class="line-number">74</div><div class="line-number">75</div><div class="line-number">76</div><div class="line-number">77</div><div class="line-number">78</div><div class="line-number">79</div><div class="line-number">80</div><div class="line-number">81</div><div class="line-number">82</div><div class="line-number">83</div><div class="line-number">84</div><div class="line-number">85</div><div class="line-number">86</div><div class="line-number">87</div></code></pre></td><td class="code"><pre><code><div class="line">------—_xbo_dropdown.html.erb----------</div><br><div class="line">&lt;h4&gt;下拉菜单字段类型&lt;/h4&gt;</div><br><div class="line">&lt;%= form_for field, url: xbo_form_xbo_field_path(xbo_form, field), remote: true, method: "put" do |xbo_dropdown| %&gt;</div><div class="line">  &lt;%= xbo_dropdown.label '字段名称：' %&gt;</div><div class="line">  &lt;%= xbo_dropdown.text_field :name %&gt;</div><div class="line">  &lt;%= xbo_dropdown.label '字段标签：' %&gt;</div><div class="line">  &lt;%= xbo_dropdown.text_field :label %&gt;</div><div class="line">  &lt;%= xbo_dropdown.label '提示文字：' %&gt;</div><div class="line">  &lt;%= xbo_dropdown.text_field :help_text %&gt;</div><div class="line">  &lt;%= xbo_dropdown.label '下拉参数列表' %&gt;</div><br><div class="line">  &lt;%= select_tag :item_list_temp, options_for_select(field.item_list), prompt: '-----请选择----', id: "select_items" %&gt;</div><div class="line">  &lt;%= xbo_dropdown.hidden_field :item_list %&gt;</div><br><div class="line">  &lt;%= link_to '编辑参数', "#", id: "edit_dropdown_arg", title: "点击编辑下拉菜单参数" %&gt;</div><br><div class="line">  &lt;%= xbo_dropdown.submit "保存", class: "btn btn-primary", disable_with: "保存中..." %&gt;</div><div class="line">  &lt;%= link_to '删除', xbo_form_xbo_field_path(xbo_form, field), confirm: '确定删除该表单字段吗？', method: :delete, remote: true %&gt;</div><div class="line">&lt;% end %&gt; </div><div class="line">//下拉菜单参数操作</div><div class="line">&lt;div class="modal hide" id="arg_add"&gt;</div><div class="line">  &lt;div class="modal-header"&gt;</div><div class="line">    &lt;button type="button" class="close" data-dismiss="modal"&gt;×&lt;/button&gt;</div><div class="line">    &lt;h3&gt;定义下拉菜单选项参数&lt;/h3&gt;</div><div class="line">  &lt;/div&gt;</div><br><div class="line">  &lt;div class="modal-body"&gt;</div><div class="line">  &lt;div&gt;</div><div class="line">    &lt;input type="text" id="dropdown_text" class="input-small" placeholder="参数文字"&gt;&lt;/input&gt;</div><div class="line">    &lt;input type="text" id="dropdown_value" class="input-small" placeholder="参数值"&gt;&lt;/input&gt;</div><div class="line">    &lt;input type="button" id="add_arg" class="btn btn-info" value="添加"&gt;&lt;/input&gt;</div><div class="line">  &lt;/div&gt; </div><div class="line">  &lt;div&gt;</div><div class="line">    &lt;table id="arg_list" class="table table-striped"&gt;</div><div class="line">      &lt;tr class="nodrop nodrag"&gt;&lt;th&gt;参数名称&lt;/th&gt;&lt;th&gt;参数值&lt;/th&gt;&lt;th&gt;编辑&lt;/th&gt;&lt;th&gt;删除&lt;/th&gt;&lt;/tr&gt;</div><div class="line">    &lt;/table&gt;</div><br><div class="line">  &lt;/div&gt;</div><div class="line">  &lt;div class="modal-footer"&gt;</div><div class="line">    &lt;a href="#" class="btn" data-dismiss="modal"&gt;关闭&lt;/a&gt;</div><div class="line">    &lt;a href="#" id="add_to_dropdown" class="btn btn-primary" data-dismiss="modal"&gt;保存参数&lt;/a&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;/div&gt;</div><br><div class="line">&lt;script type="text/javascript" charset="utf-8"&gt;</div><br><div class="line">$('#edit_dropdown_arg').tooltip({delay: {show: 500, hide: 100}}).click(function(){ </div><div class="line">    $('#arg_add').modal({</div><div class="line">      backdrop: true</div><div class="line">    });</div><div class="line">    $('#arg_list').tableDnD();</div><div class="line">    $('#add_to_dropdown').click(function(){</div><div class="line">      insert_into_select_items();</div><div class="line">    });</div><div class="line">  });</div><br><div class="line">$('#add_arg').click(function(){</div><div class="line">  var item_text = $('#dropdown_text').val()</div><div class="line">  var item_value = $('#dropdown_value').val()</div><div class="line">  $('#arg_list').append("&lt;tr class='arg'&gt;&lt;td&gt;" + item_text + "&lt;/td&gt;&lt;td&gt;" + item_value + "&lt;/td&gt;&lt;td&gt;&lt;a href='#'&gt;编辑&lt;/a&gt;&lt;/td&gt;&lt;td&gt;&lt;a href='#'&gt;删除&lt;/a&gt;&lt;/td&gt;&lt;/tr&gt;");</div><div class="line">  $('#arg_list').tableDnD(); </div><br><div class="line">  });</div><br><div class="line">function insert_into_select_items()</div><div class="line">{</div><div class="line">  var item_list = [];</div><div class="line">  var item_arrays = [];</div><br><div class="line">  $('#arg_list tr[class=arg]').each(function(){</div><div class="line">        //item_list.push([$(this).children().eq(0).html(),$(this).children().eq(1).html()]);</div><div class="line">      var _item = {"text": $(this).children().eq(0).html(), "value": $(this).children().eq(1).html()};</div><div class="line">      item_list.push(_item);</div><div class="line">      });</div><br><div class="line">  $.each(item_list,function(num,item){</div><div class="line">      $("#select_items").append("&lt;option value='" + item['value'] + "'&gt;" + item['text'] + "&lt;/option&gt;");</div><div class="line">      //var _item_array = new Array(item['text'], item['value'] + ";");</div><div class="line">      item_arrays.push(item['text'] + "_" + item['value']);</div><div class="line">      })</div><br><div class="line">  $("#xbo_dropdown_item_list").val(item_arrays);</div><div class="line">}</div><br><div class="line">&lt;/script&gt;</div></code></pre></td></tr></table></figure>

<p>我们在表单项的模板中，不仅可以设计表单的特有样式，还可以嵌入表单项的特有属性的操作，当需要增加新的类型的表单项的时候，只需要设计新的表单项模板即可。

</p>
<h4>填写表单</h4>
<p>由于每一类的表单字段都是动态的，因此不可能针对每类表单就生成对应的数据表。我采用的方式是将所有的表单数据都放在表单数据集合中(xbo_submissions)，根据不同的表单ID，读取不同的表单数据。而每一条表单数据的内容是以Hash的形式保存的。如下所示：

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div><div class="line-number">5</div><div class="line-number">6</div><div class="line-number">7</div><div class="line-number">8</div></code></pre></td><td class="code"><pre><code><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">XboSubmission</span></span></div><div class="line">  <span class="keyword">include</span> <span class="constant">Mongoid::Document</span></div><div class="line">  </div><div class="line">  field <span class="symbol">:name</span>, <span class="symbol">type:</span> <span class="constant">String</span></div><div class="line">  field <span class="symbol">:content</span>, <span class="symbol">type:</span> <span class="constant">Hash</span></div><br><div class="line">  belongs_to <span class="symbol">:xbo_form</span></div><div class="line"><span class="keyword">end</span></div></code></pre></td></tr></table></figure>

<p>因为mongodb本身就是文档型的数据库，所以保存在单一的文档中应该不是问题。同时，通过对&quot;xbo_form_id&quot;进行索引，也应该能有效的解决查询的问题。以下是提交数据的表单：

</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><code><div class="line-number">1</div><div class="line-number">2</div><div class="line-number">3</div><div class="line-number">4</div><div class="line-number">5</div><div class="line-number">6</div><div class="line-number">7</div><div class="line-number">8</div><div class="line-number">9</div><div class="line-number">10</div><div class="line-number">11</div><div class="line-number">12</div><div class="line-number">13</div><div class="line-number">14</div><div class="line-number">15</div><div class="line-number">16</div><div class="line-number">17</div><div class="line-number">18</div><div class="line-number">19</div><div class="line-number">20</div><div class="line-number">21</div><div class="line-number">22</div><div class="line-number">23</div></code></pre></td><td class="code"><pre><code><div class="line">&lt;%= form_for @xbo_submission, url: xbo_form_xbo_submissions_path(@xbo_form) do |f| %&gt;</div><div class="line">  &lt;%= f.hidden_field :name, placeholder: @xbo_form.name %&gt;</div><div class="line">  &lt;%= f.fields_for :content do |con| %&gt;</div><div class="line">    &lt;% @xbo_form.xbo_fields.each do |field| %&gt;</div><div class="line">      &lt;% case field._type %&gt;</div><div class="line">      &lt;% when "XboString" %&gt;</div><div class="line">        &lt;%= con.label field.label %&gt;</div><div class="line">        &lt;%= con.text_field field.name %&gt;</div><div class="line">      &lt;% when "XboDropdown" %&gt;</div><div class="line">        &lt;%= con.label field.label %&gt;</div><div class="line">        &lt;%= con.select field.name, options_for_select(field.item_list), prompt: "---请选择---" %&gt;</div><div class="line">      &lt;% when "XboEmail" %&gt;</div><div class="line">        &lt;%= con.label field.label %&gt; </div><div class="line">        &lt;div class='input-prepend'&gt;&lt;span class='add-on'&gt;&lt;i class='icon-envelope'&gt;&lt;/i&gt;&lt;/span&gt;&lt;%= con.text_field field.name %&gt;&lt;/div&gt; </div><div class="line">      &lt;% end %&gt;</div><div class="line">    &lt;% end %&gt;</div><div class="line">  &lt;% end %&gt;</div><br><div class="line">  &lt;div&gt;</div><div class="line">    &lt;%= f.submit '提交', class: "btn btn-primary" %&gt;</div><div class="line">    &lt;%= link_to '返回', xbo_form_xbo_submissions_path(@xbo_form) %&gt;</div><div class="line">  &lt;/div&gt;</div><div class="line">&lt;% end %&gt;</div></code></pre></td></tr></table></figure>
      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-07-02T00:00:00.000Z"><a href="/2012/07/02/2012-07-02-monthly-summary-05-06/">Jul 2, 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/07/02/2012-07-02-monthly-summary-05-06/">月度学习总结--5月至6月</a></h1>
  

    </header>
    <div class="entry">
      
        <ul>
<li><p>学习coffescript，两个有用的学习资源地址<em>coffee-script中文手册</em>: <a href="arcturo.github.com/library/coffeescript/index.html">英文版</a>,<a href="island205.github.com/tlboc">中文版</a> <em>smooth coffeescript</em>: <a href="autotelicum.github.com/Smooth-CoffeeScript/">地址</a></p>
</li>
<li><p>基于coffeescript编写了一个俄罗斯方块的小游戏，终于弥补了我多年的遗憾，可以点<a href="/public/Terris/Terris.html">这里</a>查看;</p>
</li>
<li><p>初步学习了MongoDB,学习了Mongoid的使用</p>
</li>
<li><p>基于flotr2编写了几个图表统计样例,可以点<a href="/public/Analyse/analyse/proj_analyze_total.html">这里</a>,<a href="/public/Analyse/analyse/proj_analyze_link_relative.html">这里</a>,以及<a href="/public/Analyse/analyse/proj_analyze_month.html">这里</a>;</p>
</li>
</ul>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-05-17T00:00:00.000Z"><a href="/2012/05/17/2012-05-17-env-create/">May 17, 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/05/17/2012-05-17-env-create/">linux虚拟机上的rails环境配置</a></h1>
  

    </header>
    <div class="entry">
      
        <p>下载LMDE xcfe版的linux，并通过vmware创建虚拟机。

</p>
<p>在终端下执行以下命令安装rvm：

</p>
<pre><code><div class="line">bash &lt; <span class="xml"><span class="tag">&lt;<span class="title">(curl</span> <span class="attribute">-s</span> <span class="attribute">https:</span>//<span class="attribute">raw.github.com</span>/<span class="attribute">wayneeseguin</span>/<span class="attribute">rvm</span>/<span class="attribute">master</span>/<span class="attribute">binscripts</span>/<span class="attribute">rvm-installer</span> )</span></div></code></pre>
<p>将以下脚本追加到当前用户主目录下的.bashrc文件:

</p>
<pre><code><div class="line"><span class="string">[[ -s "$HOME/.rvm/scripts/rvrm" ]]</span> &amp;&amp; . <span class="string">"$HOME/.rvm/scripts/rvm"</span></div></code></pre>
<p>通过<code>rvm 1.9.3</code>安装ruby

</p>
<p>安装过程中遇到无法读取zlib和openssl的问题，可以通过以下方式解决：

</p>
<pre><code><div class="line"><span class="comment">rvm</span> <span class="comment">pkg</span> <span class="comment">install</span> <span class="comment">zlib</span></div><div class="line"><span class="comment">rvm</span> <span class="comment">pkg</span> <span class="comment">install</span> <span class="comment">openssl</span></div><div class="line"><span class="comment">rvm</span> <span class="comment">remove</span> <span class="comment">1</span>.<span class="comment">9</span>.<span class="comment">3</span></div><div class="line"><span class="comment">rvm</span> <span class="comment">install</span> <span class="comment">1</span>.<span class="comment">9</span>.<span class="comment">3</span> <span class="literal">-</span><span class="comment">C</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">with</span>-<span class="comment">openssl</span>-<span class="comment">dir=$HOME/</span>.<span class="comment">rvm/usr</span>,<span class="literal">-</span><span class="literal">-</span><span class="comment">with</span>-<span class="comment">iconv</span>-<span class="comment">dir=$HOME/</span>.<span class="comment">rvm/usr</div></code></pre>
<p>通过<code>gem install rails -v 3.2.3</code>安装rails

</p>
<p>接着又遇到了无法安装sqlite3的问题，可以通过如下的方式解决<code>apt-get install libsqlite3-dev</code>

</p>
<p>通过以下页面安装node.js<a href="https://gist.github.com/579814">https://gist.github.com/579814</a>

</p>
<p>期间遇到了<code>Checking for library dl  : not found</code>的问题，可以通过 <code>sudo apt-get install libcurl4-openssl-dev</code>进行解决

</p>
<p>通过<code>node -v</code>和<code>npm -v</code>检查是否安装正确

</p>
<p>通过<code>npm install coffee-script</code>安装coffeescript</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-05-13T00:00:00.000Z"><a href="/2012/05/13/2011-05-13-google-app-engine-1/">May 13, 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/05/13/2011-05-13-google-app-engine-1/">Google App Engine系列：准备</a></h1>
  

    </header>
    <div class="entry">
      
        <p>（本文译自：<a href="http://tutorialzine.com/2011/01/getting-started-with-google-app-engine/">http://tutorialzine.com/2011/01/getting-started-with-google-app-engine/</a>） 

</p>
<p>在第一节中，你将了解这个平台以及如何在平台上开发应用。通过这个系列，我们将通过Python和Jquery创建一个功能齐全的web应用，该应用能够监控你网站的性能，并且记录停机时间（downtime). 什么是Google App Engine App Engine是一个用来提供开发和运行环境的平台。这意味着快速、高可靠性、以及可扩展性。你只需要关心你的代码，并且确信google能够搞定其他的一切：） 并且这项服务还有一点好处，他提供了500万的pv，不过如果超出，你需要为此付一定的费用。 你可以采用java或者python来创建web应用。

</p>
<p>在本系列中，我们将采用python2.5。App Engine提供了一些基于数据存储、缓存、进程等的api，你可以在你的项目中使用它们。App Engine 为这些服务提供的每日配额足够我们这个系列应用的使用。 以下的这些资源将帮助你更好的了解这个平台。在开发仪表板的时候，我始终开着它们： App Engine getting started guide App Engine documentation for Python Python tutorial for beginners Python 2.5.2 documentation 准备开始 

</p>
<p>第一步：在Google App Engine上注册。如果你已经有帐号了，请登录。 
<img src="http://cdn.tutorialzine.com/wp-content/uploads/2011/01/getting-started-google-appengine.jpg" alt="p1">

</p>
<p>第二步，请安装python2.5，并下载App Engine SDK。SDK包括一个和App Engine类似的开发环境，以及一个用于发布应用的程序（App Launcher）。这意味着你可以在你的本地环境中发布web应用，并在适合的时候部署到App Engine。 

</p>
<p><img src="http://cdn.tutorialzine.com/wp-content/uploads/2011/01/app-engine-launcher.jpg" alt="p2">

</p>
<p>使用App Launcher你可以随时启动/停止，以及发布你的应用程序。并通过localhost进行访问。 

</p>
<p>点击“Run”将启动web服务器，它提供了和App Engine相同的运行环境。

</p>
<p>点击“Browse“将在你的默认浏览器中打开你的项目。

</p>
<p>“SDK Console”提供数据库的综合管理（即我们的“仪表板”将要存储数据的位置）。

</p>
<p>“Deploy”将在Appspot.com上发布并建立你的web应用。 

</p>
<p>建立你自己的仪表版 我当然不想直到系列结束你们都一直这样干看着，所以你现在应该马上建立你自己的版本，并且亲身感受一下。以下是你需要做的： 

</p>
<p>打开appengine.google.com，创建新的应用。第一次创建的时候，你需要短信确认。然后，你可以为你的应用命名。 下载“仪表版”的源码，并进行解压。 打开“App Launcher，通过“File&gt;Add Existing Application“导入这个应用。 

</p>
<p>完成以上的步骤，请用编辑器打开“app.yaml&quot;文件，修改应用标识符（your-application-identifier） application: your-application-identifier version: 1 runtime: python api_version: 接下来，打开&quot;config/config.py&quot;，修改你的应用名称，域名和搜索字符。 scriptTitle = &quot;Your Application Title&quot; fetchURL = &quot;<a href="http://domain-to-be-checked.com/">http://domain-to-be-checked.com/</a>&quot; searchString = &quot;WordInThePageText&quot; 搜索字符串必须是你的主页中存在的。比如在“仪表版”的例子中，我使用了“Tutorialzine“，这串字符的存在将告知你的 脚本：页面已经成功获取。（这段话有点不太懂是什么意思） 最后，你点击“Deploy”，就可以将你的应用部署到你的appspot.com的域名下。你可以对你的应用绑定其他的域名。

</p>
<p>现在你已经拥有了一个正常运行的“仪表版”，接下来我们将开始实战了！</p>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-05-02T00:00:00.000Z"><a href="/2012/05/02/2012-05-02-Make-Dumb-Data-Smart-with-composed-of/">May 2, 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/05/02/2012-05-02-Make-Dumb-Data-Smart-with-composed-of/">Rails Recipes --通过composed_of构建结构化数据</a></h1>
  

    </header>
    <div class="entry">
      
        <h3>问题</h3>
<p>如何对数据进行结构化封装，从而可以使用面向对象的方式进行访问呢？采用compose_of()方法可以解决这个问题！

</p>
<h3>解决方法</h3>
<p>假设现在有一个课程分数模型CourseRecord，其中有一个表示该课程分数的字段：letter_grade，该模型的表示如下：

</p>
<pre><code><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">CourseRecord</span> &lt; <span class="title">ActiveRecord</span>::<span class="title">Base</span></div><div class="line">    <span class="title">composed_of</span> :<span class="title">grade</span>,</div><div class="line">            <span class="title">class_name</span>: '<span class="title">Grade</span>', </div><div class="line">            <span class="title">mapping</span>: %<span class="title">w</span>(<span class="title">letter_grade</span> <span class="title">letter_grade</span>)</div><div class="line"><span class="title">end</span></div></code></pre>
<p>这里的grade表示封装的属性名称，并通过mapping属性将letter_grade字段与稍后提到的Grade模型中的letter_grade字段进行映射。这里的class_name属性是可选的，它表示对应的封装模型名称，如果不指定，则默认为属性封装名称，即grade。下面是Grade的模型表示：

</p>
<pre><code><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Grade</span></span></div><div class="line">    <span class="keyword">include</span> <span class="constant">Comparable</span></div><div class="line">    attr_accessor <span class="symbol">:letter_grade</span></div><div class="line">    <span class="constant">SORT_ORDER</span> = [<span class="string">"f"</span> , <span class="string">"d"</span> , <span class="string">"c"</span> , <span class="string">"b"</span> , <span class="string">"a"</span> ].inject({}) {|h, letter| </div><div class="line">    h.update <span class="string">"<span class="subst">#{letter}</span>-"</span> =&gt; h.size</div><div class="line">    h.update letter =&gt; h.size</div><div class="line">    h.update <span class="string">"<span class="subst">#{letter}</span>+"</span> =&gt; h.size</div><div class="line">    }</div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">initialize</span><span class="params">(letter_grade)</span></span></div><div class="line">        <span class="variable">@letter_grade</span> = letter_grade</div><div class="line">    <span class="keyword">end</span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">&lt;=&gt;</span><span class="params">(other)</span></span></div><div class="line">        <span class="constant">SORT_ORDER</span>[letter_grade.downcase] &lt;=&gt;</div><div class="line">        <span class="constant">SORT_ORDER</span>[other.letter_grade.downcase]</div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></code></pre>
<p>通过这种方式，我们就可以对属性进行个性化的封装。然后我们就能采用如下的方式进行比较：

</p>
<pre><code><div class="line">&gt;&gt; Grade.<span class="keyword">new</span>(<span class="string">"a-"</span>) &lt; Grade.<span class="keyword">new</span>(<span class="string">"a+"</span>) <span class="preprocessor"># =&gt; true</span></div></code></pre>
<p>其中Comparable mixin用于类中的对象间的排序。并且，这个类必须定义&lt;=&gt;操作符，用于确定对象间如何进行比较，根据是否小于，等于 或大于这个其它对象来决定返回值-1、0、1。

</p>
<p>值得一提的是想要通过<code>course.grade.letter_grade = &quot;f&quot;; course.save</code>的方式对对象的值进行修改的话，是行不通的。而必须采用<code>course.grade = Grade.new(&quot;f&quot;); course.save</code>的方式才行。

</p>
<p>特别有用的是，不仅仅是单一的字段，还可以对多个字段进行封装，比如在逻辑上应该属于一类的字段<em>street, city, state, country</em>，可以通过如下的方式封装到address对象中。

</p>
<pre><code><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> &lt; <span class="title">ActiveRecord</span>::<span class="title">Base</span></div><div class="line">    <span class="title">composed_of</span> :<span class="title">address</span>, :<span class="title">mapping</span> =&gt; [ %<span class="title">w</span>(<span class="title">address_street</span> <span class="title">street</span>),</div><div class="line">        %<span class="title">w</span>(<span class="title">address_city</span> <span class="title">city</span>),</div><div class="line">        %<span class="title">w</span>(<span class="title">address_state</span> <span class="title">state</span>) ,</div><div class="line">        %<span class="title">w</span>(<span class="title">address_country</span> <span class="title">country</span>) ]</div><div class="line"><span class="title">end</span></div></code></pre>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2012-04-28T00:00:00.000Z"><a href="/2012/04/28/2012-04-28-rails-recipes---create-declarative-named-queries/">Apr 28, 2012</a></time>
      
      
  
    <h1 class="title"><a href="/2012/04/28/2012-04-28-rails-recipes---create-declarative-named-queries/">Rails Recipes --创建自我表达的命名查询</a></h1>
  

    </header>
    <div class="entry">
      
        <h3>问题</h3>
<p>对于需要筛选数据的情况，经常会出现在控制器中定义查询方法的方式，代码如下：

</p>
<pre><code><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">WombatsController</span> <span class="inheritance">&lt; <span class="parent">ApplicationController</span></span></span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span></span></div><div class="line">        <span class="variable">@wombats</span> = <span class="constant">Wombat</span>.where( <span class="string">"bio like ?"</span>, <span class="string">"%<span class="subst">#{params[<span class="symbol">:q</span>]}</span> %"</span>).</div><div class="line">            order(<span class="symbol">:age</span>)</div><div class="line">        render <span class="symbol">:index</span></div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></code></pre>
<p>但是这种方式是不好的，因为它将业务逻辑放在了控制器中，增加了耦合度，而我们往往应该在模型中对业务进行封装，那么有什么好的方法呢？

</p>
<h3>解决方法</h3>
<p>先看一般的解决方式：

</p>
<pre><code><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wombat</span> <span class="inheritance">&lt; <span class="parent">ActiveRecord::Base</span></span></span></div><div class="line">    <span class="function"><span class="keyword">def</span> <span class="title"><span class="keyword">self</span></span>.<span class="title">with_bio_containing</span><span class="params">(query)</span></span></div><div class="line">        where( <span class="string">"bio like ?"</span>, <span class="string">"%<span class="subst">#{query}</span> %"</span>).</div><div class="line">        order(<span class="symbol">:age</span>)</div><div class="line">    <span class="keyword">end</span></div><div class="line"><span class="keyword">end</span></div></code></pre>
<p>通过将对数据的访问逻辑放在模型中，那么我们可以采用<code>@wombats=Wombat.with_bio_containing(params[:q])</code>这种调用类方法方式返回需要的数据，而不用了解具体的实现机制。

</p>
<p>接下来，我们可以采用&#39;scope&#39;方法进行更好的封装，先看个简单的例子：

</p>
<pre><code><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Person</span> &lt; <span class="title">ActiveRecord</span>::<span class="title">Base</span></div><div class="line">    <span class="title">scope</span> :<span class="title">teenagers</span>, <span class="title">where</span>( "<span class="title">age</span> &lt; 20 <span class="title">AND</span> <span class="title">age</span> &gt; 12" )</div><div class="line">    <span class="title">scope</span> :<span class="title">by_name</span>, <span class="title">order</span>(:<span class="title">name</span>)</div><div class="line"><span class="title">end</span></div></code></pre>
<p>这里我们通过<em>scope</em>对查询和排序条件进行了命名，于是可以采用<code>Person.teenagers.count</code>的方式返回查询条件内的数量，更进一步，可以采用<code>Person.teenagers.by_name.map &amp;:name</code>这种链式调用的方式返回按名字排序的人员数组。

</p>
<p>最后，回看第一个列子，如何在这种方式中使用动态查询呢？代码如下：

</p>
<pre><code><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Wombat</span> &lt; <span class="title">ActiveRecord</span>:</span>:Base</div><div class="line">    scope :with_bio_containing, <span class="keyword">lambda</span> {|query| where( <span class="string">"bio like ?"</span>, <span class="string">"% #{query} %"</span>).order(:age) }</div><div class="line">end</div></code></pre>
<p>我们在scope中引入了lambda对象，这样，我们就能通过代码块的方式动态的获取查询条件了。值得一提的是：<code>Person.teenagers</code>返回的并不是一组序列，而是返回的<em>ActiveRecord::Relation</em>的实例，这可以通过<code>Person.teenagers.to_sql</code>返回的是一段sql查询代码看出来，具体的查询代码如下：

</p>
<pre><code><div class="line"><span class="operator"><span class="keyword">select</span> <span class="string">"people"</span>.* <span class="keyword">from</span> <span class="string">"people"</span> <span class="keyword">where</span> (age&lt;<span class="number">20</span> <span class="keyword">and</span> age&gt;<span class="number">12</span>)</div></code></pre>

      
    </div>
    <footer>
      
        
        
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>




<nav id="pagination">
  
  
    <a href="/page/2/" class="alignright next">Next</a>
  
  <div class="clearfix"></div>
</nav></div></div>
    <aside id="sidebar" class="alignright">
<div class="search">
  <form action="http://google.com/search" method="get" accept-charset="utf-8">
    <input type="text" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:xiongbo.me">
  </form>
</div>




<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/Project/">Project</a><small>1</small></li>
  
    <li><a href="/tags/Rails-Recipes/">Rails-Recipes</a><small>3</small></li>
  
    <li><a href="/tags/blog/">blog</a><small>1</small></li>
  
    <li><a href="/tags/design/">design</a><small>1</small></li>
  
    <li><a href="/tags/project/">project</a><small>1</small></li>
  
    <li><a href="/tags/reading-notes/">reading-notes</a><small>3</small></li>
  
    <li><a href="/tags/summary/">summary</a><small>3</small></li>
  
    <li><a href="/tags/tools/">tools</a><small>1</small></li>
  
    <li><a href="/tags/translate/">translate</a><small>3</small></li>
  
  </ul>
</div>



</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 xiongbo
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'xiongbo';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>