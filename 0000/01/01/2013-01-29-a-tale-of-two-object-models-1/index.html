<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>xiongbo.ME</title>
  <meta name="author" content="xiongbo">
  
  <meta name="description" content="A Tale of Two Object Models: Javascript and Ruby (Part 1)


一对好基友的传说（第一部分）
This past year I’ve been developing a web application with Ruby on Rails an">
  
  
  <meta name="viewport" content="width=device-width; initial-scale=1; maximum-scale=1">

  
  <meta property="og:site_name" content="xiongbo.ME"/>

  <link rel="alternate" href="/atom.xml" title="xiongbo.ME" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.8/jquery.min.js"></script>
  
</head>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">xiongbo.ME</a></h1>
  <h2><a href="/">project code and simple life</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">

<article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="-000001-12-31T16:00:00.000Z"><a href="/0000/01/01/2013-01-29-a-tale-of-two-object-models-1/">Jan 1, 0000</a></time>
      
      
  
    <h1 class="title">undefined</h1>
  

    </header>
    <div class="entry">
      
        <p>A Tale of Two Object Models: Javascript and Ruby (Part 1)

</p>
<h1>一对好基友的传说（第一部分）</h1>
<p>This past year I’ve been developing a web application with Ruby on Rails and javascript, and although javascript is not a new language for me, I’ve had an amazing time learning Ruby and its powerful metaprogramming capabilities. As I regularly switch between the two languages (as you do buidling web applications) I’ve recently found myself comparing the two object models. I thought I would give my own personal take on the object models of both languages, cementing the fundamental differences while demonstrating the similarities
This is a loaded topic, so I thought I would start with the fundamentals and talk about what objects are exactly in these two languages.

</p>
<p>过去的一年，我一直在使用Ruby on Rails 和 javascript进行web应用开发，尽管我对javascript很熟悉，但是我还是在学习ruby的过程中对它强大的元编程能力感到震惊。由于我需要经常在两种语言间转化（你懂得），我最近经常会在两种对象模型间比较。因此我想从我的视角来呈现这两种语言的对象模型，在展示它们相似性的同时也会(cementing)他们的根本区别。

</p>
<p>因为这是一个系列文章，所以我想我应该从基础开始，首先谈一谈这两种语言中的对象细节。

</p>
<p>What are javascript objects?

</p>
<p>什么是javascript 对象？

</p>
<p>Javascript objects are composite data structures comprised of properties. You can create simple objects and write to properties like so:

</p>
<p>javascript 对象

</p>
<p>var obj = {};
obj.name = &quot;Adam&quot;
is the same as:

</p>
<p>1
2
3
var obj = {
  name: &quot;Adam&quot;
};
which is the same as:

</p>
<p>1
2
var obj = {};
obj[&quot;name&quot;] = &quot;Adam&quot;;
The above examples demonstrate how objects are created using the literal technique (you can also create javascript objects using constructor functions, but we’ll get to that in part two). Literal objects are simple objects that you mold to your liking by setting properties. Since functions are also objects, you can define a property as a function and execute it:

</p>
<p>1
2
3
4
5
var obj = {};
obj.sayHi = function() {
  return &quot;hi&quot;;
}
obj.sayHi(); // returns hi
Note the familiar () syntax after the function call: this means execute me like I’m a function. If you leave that out, you return the function as if you’re calling the name property shown above.

</p>
<p>It’s reasonable to think that javascript objects look a lot like Hashes, and if you were to compare JS objects to Ruby hash objects, they look syntactically similar.

</p>
<p>1
2
hash = { name: &quot;Adam&quot; } #ruby hash
puts hash[:name] #prints &quot;Adam&quot;
1
2
var obj = { name: &quot;Adam&quot; } // js object
console.log(obj[&quot;name&quot;]) //prints &quot;Adam&quot;
As you can see, JS objects appear like simple dictionaries, a repository of properties that reference other objects and you can access these properties directly on the object. As a side note, various JS engines do not necessarily implement objects as hash tables under the hood. Check out the way V8 implements property access.

</p>
<p>What are Ruby objects?

</p>
<p>Where a JS object is a collection of properties that reference other objects, a ruby object contains a hash of instance variables that reference other objects. You can not access these instance variables in the same way that you can access (read or write to) JS properties. Ruby enforces a level of data encapsulation which protects these variables. Only when you are within the context of an object, which occurs during a method call, you can create or alter instance variables.

</p>
<p>1
2
3
4
5
6
7
8
class Simple
  def var
    @var
  end
  def var=(val)
    @var = val
  end
simple_obj = Simple.new
Before we talk about the instance variable @var, it’s a good time to discuss the Simple class above, because Ruby objects can not exist without classes.

</p>
<p>A (very) brief intro to Ruby classes

</p>
<p>Ruby is a class based language, whereas JS is not (although you can achieve level of class like behaviour). In Ruby, every object has an associated class:

</p>
<p>1
2
3
4
[1] pry(main)&gt; 2.class
=&gt; Fixnum
[2] pry(main)&gt; simple<em>obj.class
=&gt; Simple
You could say that the JS equivalent to this method is the <em>_proto</em></em> property, even though this represents the prototype object from which the JS object was created. This will be discussed in the length in part two.

</p>
<p>Ruby classes are a place to define methods, which give objects their behaviour:

</p>
<p>Passing false excludes instance methods from ancestor classes
1
2
[1] pry(main)&gt; Simple.instance_methods(false)
=&gt; [:var, :var=]
Notice that the methods returned above are defined in our Simple class. These are the proverbial getters and setters that are familiar if you have used Java or C#. They provide access to the @var instance variable that we can not access otherwise. In Ruby, we can simplify the Simple class code by calling the class method attr_accessor to define these getters and setters for us:

</p>
<p>1
2
3
class Simple
  attr_accessor :var
end
If you repeat the instance_methods call on our new implementation:

</p>
<p>1
2
[1] pry(main)&gt; Simple.instance_methods(false)
=&gt; [:var, :var=]
the results are the same as the original implementation. attr_accessor wrote these methods for us. This is a little bit of metaprogramming magic (which we will talk about in a future part).

</p>
<p>In JS, there would be no need to create functions to do this, since properties on JS objects are publicly accessible.

</p>
<p>In Ruby, classes (like almost everything) are objects and so we can call methods directly on them:

</p>
<p>1
2
3
4
[1] pry(main)&gt; Simple.is_a? Object
=&gt; true
[2] pry(main)&gt; Simple.class
=&gt; Class
Notice that the class of Simple is Class. If you peek at the instance methods of Class:

</p>
<p>1
2
[1] pry(main)&gt; Class.instance_methods(false)
=&gt; [:allocate, :new, :duplicate]
you will find the new method. This method is the mechanism to create a new object (covered in part two).

</p>
<p>Classes are responsible for a lot of magic in Ruby, and we will cover Ruby classes extensively in future parts.

</p>
<p>Instance variables

</p>
<p>So getting back to the @var instance variable. In the sample above, @var is accessible through the getters and setters:

</p>
<p>1
2
3
4
5
[4] pry(main)&gt; simple_obj.var
=&gt; nil
[5] pry(main)&gt; simple_obj.var = 4
[6] pry(main)&gt; simple_obj.var
=&gt; 4
Note that this appears similar to JS access to properties, but in fact, var is a method call on simple_obj, which is the method receiver. In the JS equivalent, var would be a property, not a method (function) call.

</p>
<p>The @ notation basically means: access this instance variable in the scope of the current context. The current context is the object referenced by simple_obj. The current context is an important concept in both JS and Ruby (which is where the this and self keywords come into play), and we will cover this in part two when we look at object creation.

</p>
<p>Remember when I said that instance variables are private to the object? Well this is not quite true. Ruby gives you a lot of power and has some interesting methods that allow you to peek inside the object:

</p>
<p>1
2
3
[1] pry(main)&gt; simple_obj = Simple.new
[2] pry(main)&gt; simple_obj.instance_variables
=&gt; []
At this point, no instance variables have been assigned to the object.

</p>
<p>1
2
3
[3] pry(main)&gt; simple_obj.instance_variable_set(:@var, &quot;hi!&quot;)
[4] pry(main)&gt; simple_obj.instance_variables
=&gt; [:@var]
Now that @var is assigned, see it in the second call.

</p>
<p>1
2
[5] pry(main)&gt; simple_obj.instance_variable_get(:@var)
=&gt; &quot;hi!&quot;
Summary

</p>
<p>At their very core objects in JS and Ruby are simply repositories of references to other objects.

</p>
<p>The essential difference is that JS does not restrict access to properties. The language itself does not support any data encapsulation on objects directly. That does not mean you can not achieve this in other ways however through function scopes acting as modules.

</p>
<p>Ruby on the other hand enforces a certain level of data encapsulation by not providing a simple way to access its internal instance variables. You have to enter the object’s context through a method call to operate on instance variables. However, we just demonstrated above that there are methods that allow you to peek into, change or get individual instance variables which break this data encapsulation.

</p>
<p>Javascript objects are quite simple especially when created using the literal method. It’s not until we look at object creation in the next part that we see that JS objects can also be created via constructor functions. This opens up the concept of prototypal inheritance, which is javascript’s inheritance mechanism. This is where the JS object model starts to get a little more involved.

</p>
<p>Ruby objects are more involved since objects contain a reference to the class that created it. The object relies heavily on this relationship throughout its lifetime, since whenever a method is called, the object refers to its class (and potentially ancestor classes) to find and execute the method. Classes (and it’s parent class, Module) are what make metaprogramming possible.

</p>
<p>There is obviously a lot more to the object models of both languages, so I hope you will tune in to part two when I look at how objects are created in both languages.

</p>
<p>Further Resources

</p>
<p>Javascript: The Good Parts (Douglas Crockford)
Chapter 1 of Metaprogramming Ruby (Paulo Perotta)
Episode 1 of The Ruby Object Model and Metaprogramming (Dave Thomas)</p>

      
    </div>
    <footer>
      
        
        
        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="http://s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Comments</h1>
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</div></div>
    <aside id="sidebar" class="alignright">
<div class="search">
  <form action="http://google.com/search" method="get" accept-charset="utf-8">
    <input type="text" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:xiongbo.me">
  </form>
</div>




<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/Project/">Project</a><small>1</small></li>
  
    <li><a href="/tags/Rails-Recipes/">Rails-Recipes</a><small>3</small></li>
  
    <li><a href="/tags/blog/">blog</a><small>1</small></li>
  
    <li><a href="/tags/design/">design</a><small>1</small></li>
  
    <li><a href="/tags/dwz/">dwz</a><small>1</small></li>
  
    <li><a href="/tags/guide/">guide</a><small>2</small></li>
  
    <li><a href="/tags/j-ui/">j-ui</a><small>1</small></li>
  
    <li><a href="/tags/mvc3/">mvc3</a><small>1</small></li>
  
    <li><a href="/tags/project/">project</a><small>1</small></li>
  
    <li><a href="/tags/rails/">rails</a><small>2</small></li>
  
    <li><a href="/tags/reading-notes/">reading-notes</a><small>3</small></li>
  
    <li><a href="/tags/summary/">summary</a><small>3</small></li>
  
    <li><a href="/tags/tools/">tools</a><small>1</small></li>
  
    <li><a href="/tags/translate/">translate</a><small>3</small></li>
  
  </ul>
</div>



</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2013 xiongbo
  
</div>
<div class="clearfix"></div></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<script type="text/javascript">
var disqus_shortname = 'xiongbo';

(function(){
  var dsq = document.createElement('script');
  dsq.type = 'text/javascript';
  dsq.async = true;
  dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
  (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
}());
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>